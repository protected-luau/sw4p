<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SW4P - KeySystem [STRICT MODE]</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Courier New', Courier, monospace; }
        body { min-height: 100vh; background: #000; color: #0f0; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
        #matrixCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; opacity: 0.4; pointer-events: none; }
        .glass-panel { position: relative; z-index: 10; background: rgba(0, 20, 0, 0.85); backdrop-filter: blur(8px); border: 2px solid #0f0; border-radius: 24px; padding: 2.5rem; width: 90%; max-width: 500px; box-shadow: 0 0 30px #0f08; text-align: center; }
        h1 { font-size: 3rem; font-weight: bold; letter-spacing: 8px; text-shadow: 0 0 15px #0f0; margin-bottom: 0.5rem; }
        .sub { font-size: 0.9rem; color: #8f8; margin-bottom: 2rem; letter-spacing: 2px; }
        .access-denied { background: #1a0505; border: 1px solid #f00; padding: 2rem; border-radius: 15px; color: #f88; }
        .access-granted { background: #051a05; border: 1px solid #0f0; padding: 2rem; border-radius: 15px; }
        .key-box { background: #000; border: 1px dashed #0f0; padding: 1.2rem; margin: 1.5rem 0; cursor: pointer; transition: 0.3s; position: relative; }
        .key-box:hover { background: #0f01; box-shadow: 0 0 15px #0f04; }
        .key-display { font-size: 1.2rem; font-weight: bold; color: #0f0; word-break: break-all; letter-spacing: 1px; }
        .timer-area { font-size: 2rem; font-weight: bold; margin: 10px 0; color: #fff; text-shadow: 0 0 10px #0f0; }
        .btn-exit { background: transparent; border: 1px solid #f00; color: #f00; padding: 8px 20px; border-radius: 20px; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        .btn-exit:hover { background: #f00; color: #000; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <canvas id="matrixCanvas"></canvas>

    <div class="glass-panel">
        <h1>SW4P</h1>
        <div class="sub">UNBREAKABLE KEY SYSTEM</div>

        <div id="accessDeniedView" class="access-denied hidden">
            <div style="font-size: 3rem; margin-bottom: 10px;">ðŸš«</div>
            <h2 style="color: #f55;">INVALID SESSION</h2>
            <p>Access denied. Please generate a new link from the Roblox script.</p>
        </div>

        <div id="accessGrantedView" class="access-granted hidden">
            <div style="color: #0f0; font-weight: bold;">[ ACCESS GRANTED ]</div>
            
            <div class="key-box" onclick="copyKey()">
                <div id="keyOutput" class="key-display">GENERATING...</div>
                <div style="font-size: 0.7rem; color: #8f8; margin-top: 8px;">(Click to Copy Key)</div>
            </div>

            <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">TIME REMAINING</div>
            <div class="timer-area" id="timerDisplay">01:00:00</div>
            
            <button class="btn-exit" onclick="exitSession()">EXPIRE SESSION</button>
        </div>
    </div>

    <script>
        // --- MATRIX BACKGROUND EFFECT ---
        (function(){const c=document.getElementById('matrixCanvas'),ctx=c.getContext('2d');let w,h,drops=[];function resize(){w=window.innerWidth;h=window.innerHeight;c.width=w;c.height=h;const cols=Math.floor(w/16);drops=[];for(let i=0;i<cols;i++)drops[i]=Math.floor(Math.random()*-h)}const chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";function draw(){ctx.fillStyle='rgba(0,0,0,0.05)',ctx.fillRect(0,0,w,h),ctx.font='16px monospace',ctx.fillStyle='#0f0';for(let i=0;i<drops.length;i++){const txt=chars[Math.floor(Math.random()*chars.length)];ctx.fillText(txt,i*16,drops[i]*16);if(drops[i]*16>h&&Math.random()>0.975)drops[i]=0;drops[i]++}requestAnimationFrame(draw)}window.addEventListener('resize',resize);resize();draw()})();

        // --- STRICT KEY SYSTEM LOGIC ---
        const urlParams = new URLSearchParams(window.location.search);
        const sessionParam = urlParams.get('session');
        const ST_TIME = "sw4p_time";
        const ST_ID = "sw4p_id";

        let timeLeft;
        let timerInterval;

        // Rumus Hash Strict (Sama dengan Luau)
        function generateStrictKey(session) {
            const hour = new Date().getUTCHours();
            const secretSeed = session + hour.toString();
            
            let hash = 0;
            for (let i = 0; i < secretSeed.length; i++) {
                hash = ((hash << 5) - hash) + secretSeed.charCodeAt(i);
                hash |= 0; 
            }
            
            let seedValue = Math.abs(hash);
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            let result = "";
            
            for (let i = 0; i < 16; i++) {
                seedValue = (seedValue * 9301 + 49297) % 233280;
                result += chars[Math.floor((seedValue / 233280) * chars.length)];
            }
            return "SW4P_" + result;
        }

        function init() {
            const savedId = localStorage.getItem(ST_ID);
            
            if (sessionParam) {
                // Jika session ID di URL berbeda dengan yang di-save (Link Baru)
                if (sessionParam !== savedId) {
                    localStorage.setItem(ST_ID, sessionParam);
                    timeLeft = 3600; // Reset 1 Jam
                    localStorage.setItem(ST_TIME, timeLeft);
                } else {
                    // Jika refresh halaman, ambil waktu tersisa
                    timeLeft = parseInt(localStorage.getItem(ST_TIME)) || 3600;
                }
                showUI(true);
            } else {
                showUI(false);
            }
        }

        function showUI(granted) {
            if (granted) {
                document.getElementById('accessGrantedView').classList.remove('hidden');
                document.getElementById('keyOutput').innerText = generateStrictKey(sessionParam);
                startTimer();
            } else {
                document.getElementById('accessDeniedView').classList.remove('hidden');
                localStorage.clear();
            }
        }

        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                localStorage.setItem(ST_TIME, timeLeft);
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    exitSession();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            document.getElementById('timerDisplay').innerText = `00:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }

        window.copyKey = function() {
            const k = document.getElementById('keyOutput').innerText;
            navigator.clipboard.writeText(k);
            alert("Key Copied: " + k);
        };

        window.exitSession = function() {
            localStorage.clear();
            window.location.href = window.location.pathname;
        };

        init();
    </script>
</body>
</html>
