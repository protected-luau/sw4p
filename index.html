<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SW4P - SECURE GATE</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Courier New', Courier, monospace; }
        body { min-height: 100vh; background: #000; color: #0f0; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .glass-panel { position: relative; z-index: 10; background: rgba(0, 10, 0, 0.9); border: 2px solid #0f0; border-radius: 20px; padding: 2.5rem; width: 90%; max-width: 450px; text-align: center; box-shadow: 0 0 20px #0f05; }
        h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 0 0 10px #0f0; }
        .error { color: #f55; border: 1px solid #f55; padding: 20px; border-radius: 10px; background: #1a0000; }
        .key-box { background: #000; border: 1px dashed #0f0; padding: 15px; margin: 20px 0; cursor: pointer; }
        .timer { font-size: 2.5rem; font-weight: bold; color: #fff; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="glass-panel">
        <h1>SW4P</h1>
        <div id="denied" class="error hidden">
            <h2 id="errorMsg">INVALID SESSION</h2>
            <p style="margin-top:10px;">Security violation detected. Get a new link from the script.</p>
        </div>
        <div id="granted" class="hidden">
            <div style="color: #0f0; font-size: 0.8rem;">[ SESSION VERIFIED ]</div>
            <div class="key-box" onclick="copyKey()">
                <div id="keyOutput" style="color: #0f0; font-weight: bold;">LOADING...</div>
            </div>
            <div id="timer" class="timer">60</div>
            <p style="font-size: 0.7rem; color: #ff0;">⚠️ DO NOT REFRESH ⚠️</p>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const session = urlParams.get('session');
        const sig = urlParams.get('sig'); // Tanda tangan keamanan
        const SECRET_PASS = "SW4P_SECRET_99"; // HARUS SAMA DENGAN DI ROBLOX

        // Fungsi mencocokkan Signature (HMAC Sederhana)
        function verifySignature(sess, providedSig) {
            let hash = 0;
            let combined = sess + SECRET_PASS;
            for (let i = 0; i < combined.length; i++) {
                hash = ((hash << 5) - hash) + combined.charCodeAt(i);
                hash |= 0;
            }
            return Math.abs(hash).toString(36) === providedSig;
        }

        function generateStrictKey(sess) {
            const h = new Date().getUTCHours();
            const seed = sess + h.toString() + SECRET_PASS;
            let hash = 0;
            for (let i = 0; i < seed.length; i++) hash = ((hash << 5) - hash) + seed.charCodeAt(i), hash |= 0;
            let val = Math.abs(hash), res = "", chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            for (let i = 0; i < 16; i++) val = (val * 9301 + 49297) % 233280, res += chars[Math.floor((val / 233280) * chars.length)];
            return "SW4P_" + res;
        }

        function init() {
            // 1. Cek Signature (Mencegah modifikasi session=)
            if (!session || !sig || !verifySignature(session, sig)) {
                document.getElementById('errorMsg').innerText = "FORGED LINK DETECTED";
                document.getElementById('denied').classList.remove('hidden');
                return;
            }

            // 2. Anti-Refresh (Satu kali buka saja)
            if (sessionStorage.getItem("used_" + session)) {
                document.getElementById('errorMsg').innerText = "LINK EXPIRED";
                document.getElementById('denied').classList.remove('hidden');
                return;
            }

            sessionStorage.setItem("used_" + session, "true");
            document.getElementById('granted').classList.remove('hidden');
            document.getElementById('keyOutput').innerText = generateStrictKey(session);

            let sec = 60;
            const countdown = setInterval(() => {
                sec--;
                document.getElementById('timer').innerText = sec;
                if (sec <= 0) {
                    clearInterval(countdown);
                    location.reload(); // Paksa expired
                }
            }, 1000);
        }

        window.copyKey = function() {
            navigator.clipboard.writeText(document.getElementById('keyOutput').innerText);
            alert("Key Copied!");
        };

        init();
    </script>
</body>
</html>
